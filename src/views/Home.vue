<template>
  <div class="home">
    <h1 class="title-header">‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
    <div v-if="canBinthbat" class="text-left">
      <div class="container mb-2">
        <label for="name">‡∏ä‡∏∑‡πà‡∏≠</label>
        <b-form-input id="name" v-model="data.name" :disabled="isAnonymous" />
        <b-form-checkbox v-model="isAnonymous" class="mt-2">
          ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
        </b-form-checkbox>
      </div>

      <div class="container mb-2">
        <label for="food">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏ï‡∏£</label>
        <b-form-select
          id="food"
          placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏ï‡∏£"
          :options="foodList"
          v-model="data.food"
        ></b-form-select>
      </div>
      <div class="container">
        <label for="wish">‡∏Ç‡∏≠‡∏û‡∏£‡∏™‡∏¥</label>
        <b-form-textarea id="wish" v-model="data.wish" rows="3" max-rows="6" />
      </div>

      <h6 class="text-center my-3">
        ‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏¥‡∏ï‡∏†‡∏≤‡∏ß‡∏ô‡∏≤ ‡∏ó‡πà‡∏≠‡∏á‡∏ô‡∏∞‡πÇ‡∏° 3 ‡∏à‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏ï‡∏£
      </h6>
      <b-button class="d-flex mx-auto" @click="submitWish">‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏ï‡∏£</b-button>

      <div class="container">
        <b-row class="d-flex flex-col justify-around">
          <b-col
            cols="12"
            md="6"
            lg="4"
            v-for="wish in wishes"
            :key="wish.wish"
          >
            <WishCard :data="wish"></WishCard>
          </b-col>
        </b-row>
      </div>
    </div>

    <div v-else class="container">
      <h2>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏£‡∏∞‡∏£‡∏±‡∏ö‡∏ö‡∏¥‡∏ì‡∏ö‡∏≤‡∏ï‡∏£</h2>
      <h3>‡πÑ‡∏ß‡πâ‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏à‡∏®‡∏£‡∏±‡∏ó‡∏ò‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ï‡∏µ 5 ‡∏ñ‡∏∂‡∏á 9 ‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤‡∏ô‡∏∞</h3>
    </div>
  </div>
</template>

<script>
// @ is an alias to /src
// import HelloWorld from "@/components/HelloWorld.vue";
import db from "@/firebase.js";
import WishCard from "@/components/WishCard.vue";

export default {
  name: "Home",
  components: {
    WishCard,
  },
  data() {
    return {
      canBinthbat: false,
      isAnonymous: false,
      foodList: [
        ..."üçè üçé üçê üçä üçã üçå üçâ üçá üçì üçà üçí üçë ü•≠ üçç ü•• ü•ù üçÖ ü•ë üçÜ üå∂ ü•í ü•¨ ü•¶ üßÑ üßÖ üåΩ ü•ï ü•ó ü•î üç† ü•ú üçØ üçû ü•ê ü•ñ ü•® ü•Ø ü•û üßá üßÄ üçó üçñ ü•© üç§ ü•ö üç≥ ü•ì üçî üçü üå≠ üçï üçù ü•™ üåÆ üåØ ü•ô üßÜ üçú ü•ò üç≤ ü•´ üßÇ üßà üç• üç£ üç± üçõ üçô üçö üçò ü•ü üç¢ üç° üçß üç® üç¶ üç∞ üéÇ üßÅ ü•ß üçÆ üç≠ üç¨ üç´ üçø üç© üç™ ü•† ü•Æ ‚òï üçµ ü•£ üçº ü•§ üßÉ üßâ ü•õ ü•°".split(
          " "
        ),
      ],
      data: {
        name: "",
        food: "",
        wish: "",
      },
      wishes: [
        // { name: "test", food: "üçê", wish: "we wish you marry christmas" },
        // { name: "test 2", food: "üçá", wish: "we wish you marry christmas" },
        // { food: "ü•ú", wish: "we wish you marry christmas" },
      ],
      isLoading: false,
    };
  },
  methods: {
    submitWish() {
      if (!this.isLoading) {
        this.isLoading = true;
        let wish;
        if (this.isAnonymous) {
          // eslint-disable-next-line no-unused-vars
          const { name, ...data } = this.data;
          wish = data;
        } else {
          wish = this.data;
        }

        this.data = {
          name: "",
          food: "",
          wish: "",
        };

        // this.wishes.push(wish);
        db.collection("takbatr-2021")
          .add(wish)
          .then((result) => {
            console.log(result);
            this.$bvModal.msgBoxOk(
              "‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏á‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏°‡∏ï‡∏ï‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏™‡∏£‡∏£‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏¥‡∏ï‡πÄ‡∏°‡∏ï‡∏ï‡∏≤ ‡πÄ‡∏ó‡∏≠‡∏ç‡∏Ø",
              {
                title: "‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                size: "md",
                buttonSize: "md",
                okVariant: "success",
                okTitle: "‡∏™‡∏≤‡∏ò‡∏∏ ‡∏™‡∏≤‡∏ò‡∏∏ ‡∏™‡∏≤‡∏ò‡∏∏",
                headerClass: "p-2 border-bottom-0",
                footerClass: "p-2 border-top-0",
                centered: true,
              }
            );
          })
          .catch((err) => {
            console.log(err);
            this.$bvModal.msgBoxOk(
              "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ö‡∏≤‡∏ï‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
              {
                title: "Confirmation",
                size: "sm",
                buttonSize: "md",
                okVariant: "danger",
                okTitle: "‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏î‡∏π",
                headerClass: "p-2 border-bottom-0",
                footerClass: "p-2 border-top-0",
                centered: true,
              }
            );
          })
          .finally(() => {
            this.isLoading = false;
          });
      }
    },
    async readWishesFromDB() {
      db.collection("takbatr-2021")
        .get()
        .then((snapshot) => {
          this.wishes = [...snapshot.docs.map((snap) => snap.data())];
        })
        .catch((err) => console.error(err));
    },
  },
  mounted() {
    this.canBinthbat = false;
    const datetime = new Date();
    if (datetime.getHours() >= 5 && datetime.getHours() < 9) {
      this.canBinthbat = true;
    } else {
      // alert("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏£‡∏∞‡∏£‡∏±‡∏ö‡∏ö‡∏¥‡∏ì‡∏ö‡∏≤‡∏ï‡∏£");
    }

    this.readWishesFromDB();
  },
};
</script>

<style lang="scss">
.title-header {
  font-weight: 700;
  font-size: 2.5rem;
}
</style>
